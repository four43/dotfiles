#!/bin/bash

# Starts tmux in a smart way
# Connects to an existing "main" session if we have one, otherwise makes a new sesion
TMUX_MAIN_SESSION="main"

if [[ ! -z "${TMUX}" ]] || [[ "${TERM}" =~ "screen".* ]]; then
    exit
fi 

SESSION_STATUS=$(tmux list-sessions | grep "${TMUX_MAIN_SESSION}")
if [[ ! -z "${SESSION_STATUS}" ]]; then
    if $(echo "${SESSION_STATUS}" | grep "attached"); then
        exec tmux
    else
        exec tmux attach-session -d -t "${TMUX_MAIN_SESSION}"
    fi
else
    # No main session yet
    exec tmux new -s "${TMUX_MAIN_SESSION}"
fi

